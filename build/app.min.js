var STEREOGRAM=function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var a=function(t,e,i){return t+(e-t)*i},n=function(t,e,i){return Math.max(e,Math.min(i,t))};function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var r=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cvsTile=document.querySelector("#canvas-tile"),this.cvsTile.width=100,this.cvsTile.height=100,this.ctxTile=this.cvsTile.getContext("2d"),this.ctxTile.fillStyle="#fff",this.ctxTile.fillRect(0,0,this.cvsTile.width,this.cvsTile.height),this.ctxTile.fillStyle="#000";for(var i=0;i<this.cvsTile.width;i++)for(var a=0;a<this.cvsTile.height;a++)Math.random()>.5&&this.ctxTile.fillRect(i,a,1,1);this.cvsDepthMap=document.querySelector("#canvas-depth-map"),this.cvsDepthMap.width=200,this.cvsDepthMap.height=200,this.ctxDepthMap=this.cvsDepthMap.getContext("2d"),this.ctxDepthMap.fillStyle="#000",this.ctxDepthMap.fillRect(0,0,this.cvsDepthMap.width,this.cvsDepthMap.height),this.ctxDepthMap.fillStyle="#fff",this.ctxDepthMap.beginPath(),this.ctxDepthMap.arc(100,100,50,0,2*Math.PI),this.ctxDepthMap.fill(),this.cvsOutput=document.querySelector("#canvas-output"),this.cvsOutput.width=400,this.cvsOutput.height=400,this.ctxOutput=this.cvsOutput.getContext("2d"),this.el={},this.el.buttonGenerateImage=document.querySelector("#button-generate-image"),this.el.buttonGenerateImageMessage=document.querySelector("#button-generate-image-message"),this.el.fileInputTileImage=document.querySelector("#input-tile"),this.el.fileInputDepthMapImage=document.querySelector("#input-depth-map"),this.el.dropContainerTileImage=document.querySelector("#drop-input-tile"),this.el.dropContainerDepthMapImage=document.querySelector("#drop-input-depth-map"),this.el.buttonDimensionsAuto=document.querySelector("#button-dimensions-auto"),this.el.inputWidth=document.querySelector("#input-width"),this.el.inputHeight=document.querySelector("#input-height"),this.el.inputStrips=document.querySelector("#input-strips"),this.el.inputScaleDimensions=document.querySelector("#input-scale-dimensions"),this.el.buttonScaleDimensions=document.querySelector("#button-scale-apply"),this.el.selectInterpolation=document.querySelector("#input-interpolation"),this.el.selectDepthModel=document.querySelector("#input-depth-model"),this.el.buttonGenerateImage.onclick=function(){e.el.buttonGenerateImageMessage.innerText="Working...",setTimeout((function(){e._generateImage()}),50)},this.el.fileInputTileImage.onchange=function(){var t=e.el.fileInputTileImage.files[0];e.setCanvasImageFromFile(e.ctxTile,t)},this.el.fileInputDepthMapImage.onchange=function(){var t=e.el.fileInputDepthMapImage.files[0];e.setCanvasImageFromFile(e.ctxDepthMap,t)},this.el.dropContainerTileImage.ondragover=this.el.dropContainerTileImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerTileImage.classList.add("drag-over")},this.el.dropContainerTileImage.onmouseleave=this.el.dropContainerTileImage.onmouseup=function(){e.el.dropContainerTileImage.classList.remove("drag-over")},this.el.dropContainerTileImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctxTile,i)}},this.el.dropContainerDepthMapImage.ondragover=this.el.dropContainerDepthMapImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerDepthMapImage.classList.add("drag-over")},this.el.dropContainerDepthMapImage.onmouseleave=this.el.dropContainerDepthMapImage.onmouseup=function(){e.el.dropContainerDepthMapImage.classList.remove("drag-over")},this.el.dropContainerDepthMapImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctxDepthMap,i)}},this.el.buttonDimensionsAuto.onclick=function(){var t=parseInt(e.el.inputStrips.value),i=(t+1)*e.cvsTile.width,a=e.cvsDepthMap.height/e.cvsDepthMap.width,n=Math.round(t*e.cvsTile.width*a);e.el.inputWidth.value=i,e.el.inputHeight.value=n},this.el.buttonScaleDimensions.onclick=function(){var t=parseInt(e.el.inputWidth.value),i=parseInt(e.el.inputHeight.value),a=parseFloat(e.el.inputScaleDimensions.value);e.el.inputWidth.value=t*a,e.el.inputHeight.value=i*a},this._generateImage()}var e,i,r;return e=t,(i=[{key:"_generateImage",value:function(){this.cvsOutput.width=parseInt(this.el.inputWidth.value),this.cvsOutput.height=parseInt(this.el.inputHeight.value),this.state={},this.state.strips=parseInt(this.el.inputStrips.value),this.state.tileWidth=this.cvsTile.width,this.state.tileHeight=this.cvsTile.height,this.state.depthStripWidth=this.cvsDepthMap.width/this.state.strips,this.state.outputStripWidth=this.cvsOutput.width/(this.state.strips+1),this.state.depthScale=parseFloat(document.querySelector("#input-depth-scale").value),this.state.invert=!!document.querySelector("#input-invert").checked,this.state.depthModel=this.el.selectDepthModel.value,this.state.interpolation=this.el.selectInterpolation.value,this.state.bubble=!!document.querySelector("#input-bubble").checked,this.state.tilt=!!document.querySelector("#input-tilt").checked,this.data={},this.data.tile=this.ctxTile.getImageData(0,0,this.cvsTile.width,this.cvsTile.height),this.data.depthMap=this.ctxDepthMap.getImageData(0,0,this.cvsDepthMap.width,this.cvsDepthMap.height),this.data.output=this.ctxOutput.createImageData(this.cvsOutput.width,this.cvsOutput.height),this._process(),this.el.buttonGenerateImageMessage.innerText=""}},{key:"_process",value:function(){for(var t=0;t<this.cvsOutput.width;t++)for(var e=0;e<this.cvsOutput.height;e++)this._compute(t,e);this.ctxOutput.putImageData(this.data.output,0,0)}},{key:"_compute",value:function(t,e){var i=null;if(t<this.state.outputStripWidth){var a=t%this.state.outputStripWidth/this.state.outputStripWidth*this.state.tileWidth,n=e%this.state.tileHeight;i=this.getPixel(this.data.tile,a,n)}else{var s=(t-this.state.outputStripWidth)/(this.cvsOutput.width-this.state.outputStripWidth),r=e/this.cvsOutput.height,h=s*this.cvsDepthMap.width,o=r*this.cvsDepthMap.height,u=this.getDepth(this.getPixel(this.data.depthMap,h,o));this.state.invert&&(u=1-u);var l=u*this.state.depthScale;this.state.bubble&&(l*=Math.abs(Math.cos(s*Math.PI))),this.state.tilt&&(l*=Math.cos(s*Math.PI)),i=this.getPixel(this.data.output,t-this.state.outputStripWidth+l,e)}if(i){var p=4*(e*this.data.output.width+t);this.data.output.data[p+0]=i[0],this.data.output.data[p+1]=i[1],this.data.output.data[p+2]=i[2],this.data.output.data[p+3]=i[3]}}},{key:"getDepth",value:function(t){return(t[0]+t[1]+t[2])/765}},{key:"getPixel",value:function(t,e,i){e=n(e,0,t.width),i=n(i,0,t.height);var s=Math.floor(e%t.width),r=Math.floor(i%t.height);if("none"==this.state.interpolation||e-s==0){var h=4*(r*t.width+s);return[t.data[h+0],t.data[h+1],t.data[h+2],t.data[h+3]]}var o,u,l,p,c=this.getPixel(t,s,r),d=this.getPixel(t,s+1,r),v=e-s;return"nearest-neighbour"==this.state.interpolation?v<.5?(o=c[0],u=c[1],l=c[2],p=c[3]):(o=d[0],u=d[1],l=d[2],p=d[3]):"bilinear"==this.state.interpolation?(o=a(c[0],d[0],v),u=a(c[1],d[1],v),l=a(c[2],d[2],v),p=a(c[3],d[3],v)):"bicubic"==this.state.interpolation&&(v*=v*v,o=a(c[0],d[0],v),u=a(c[1],d[1],v),l=a(c[2],d[2],v),p=a(c[3],d[3],v)),[o,u,l,p]}},{key:"blend",value:function(t,e,i){return t+(e-t)*i}},{key:"setCanvasImageFromFile",value:function(t,e){var i=new FileReader;i.onload=function(e){var i=new Image;i.onload=function(){t.canvas.width=i.naturalWidth,t.canvas.height=i.naturalHeight,t.drawImage(i,0,0)},i.src=e.target.result},i.readAsDataURL(e)}}])&&s(e.prototype,i),r&&s(e,r),t}();function h(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modules={stereogram:new r},Object.keys(this.modules).forEach((function(t){"function"==typeof e.modules[t].bind&&e.modules[t].bind(e)})),this._resize(),window.addEventListener("resize",(function(){e._resize()}))}var e,i,a;return e=t,(i=[{key:"_resize",value:function(){var t=this;Object.keys(this.modules).forEach((function(e){"function"==typeof t.modules[e].resize&&t.modules[e].resize()}))}}])&&h(e.prototype,i),a&&h(e,a),t}();window.addEventListener("load",(function(){new o}))}]);