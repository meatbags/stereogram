var STEREOGRAM=function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var a=function(t,e,i){return t+(e-t)*i},n=function(t,e,i){return Math.max(e,Math.min(i,t))};function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,a;return e=t,a=[{key:"quadratic",value:function(t){return t<.5?2*t*t:(4-2*t)*t-1}},{key:"cubic",value:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}}],(i=null)&&s(e.prototype,i),a&&s(e,a),t}();function o(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var h=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas={},this.ctx={},this.canvas.tile=document.querySelector("#canvas-tile"),this.canvas.depthMap=document.querySelector("#canvas-depth-map"),this.canvas.output=document.querySelector("#canvas-output"),this.ctx.tile=this.canvas.tile.getContext("2d"),this.ctx.depthMap=this.canvas.depthMap.getContext("2d"),this.ctx.output=this.canvas.output.getContext("2d"),this.canvas.tile.width=100,this.canvas.tile.height=100,this.ctx.tile.fillStyle="#fff",this.ctx.tile.fillRect(0,0,this.canvas.tile.width,this.canvas.tile.height),this.ctx.tile.fillStyle="#000";for(var i=0;i<this.canvas.tile.width;i++)for(var a=0;a<this.canvas.tile.height;a++)Math.random()>.5&&this.ctx.tile.fillRect(i,a,1,1);this.canvas.depthMap.width=150,this.canvas.depthMap.height=150,this.ctx.depthMap.fillStyle="#000",this.ctx.depthMap.fillRect(0,0,this.canvas.depthMap.width,this.canvas.depthMap.height),this.ctx.depthMap.fillStyle="#fff",this.ctx.depthMap.beginPath(),this.ctx.depthMap.arc(this.canvas.depthMap.width/2,this.canvas.depthMap.height/2,this.canvas.depthMap.height/4,0,2*Math.PI),this.ctx.depthMap.fill(),this.el={},this.el.buttonGenerateImage=document.querySelector("#button-generate-image"),this.el.outputMessage=document.querySelector("#output-message"),this.el.buttonDownload=document.querySelector("#button-download"),this.el.fileInputTileImage=document.querySelector("#input-tile"),this.el.fileInputDepthMapImage=document.querySelector("#input-depth-map"),this.el.dropContainerTileImage=document.querySelector("#drop-input-tile"),this.el.dropContainerDepthMapImage=document.querySelector("#drop-input-depth-map"),this.el.buttonDimensionsAuto=document.querySelector("#button-dimensions-auto"),this.el.inputWidth=document.querySelector("#input-width"),this.el.inputHeight=document.querySelector("#input-height"),this.el.inputStrips=document.querySelector("#input-strips"),this.el.inputDepthScale=document.querySelector("#input-depth-scale"),this.el.inputScaleDimensions=document.querySelector("#input-scale-dimensions"),this.el.buttonScaleDimensions=document.querySelector("#button-scale-apply"),this.el.selectInterpolation=document.querySelector("#input-interpolation"),this.el.selectDepthModel=document.querySelector("#input-depth-model"),this.el.depthMapOverlay=document.querySelector("#depth-map-overlay"),this.el.checkboxInvert=document.querySelector("#input-invert"),this.el.checkboxPreserveTileRatio=document.querySelector("#input-preserve-tile-ratio"),this.el.buttonGenerateImage.onclick=function(){e.el.outputMessage.innerText="Working...",e.el.outputMessage.classList.add("active"),setTimeout((function(){e.generateImage(),e.el.outputMessage.innerText="Done.",setTimeout((function(){e.el.outputMessage.classList.remove("active")}),350)}),50)},this.el.fileInputTileImage.onchange=function(){var t=e.el.fileInputTileImage.files[0];e.setCanvasImageFromFile(e.ctx.tile,t)},this.el.buttonDownload.onclick=function(){e.downloadImage()},this.el.fileInputDepthMapImage.onchange=function(){var t=e.el.fileInputDepthMapImage.files[0];e.setCanvasImageFromFile(e.ctx.depthMap,t)},this.el.dropContainerTileImage.ondragover=this.el.dropContainerTileImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerTileImage.classList.add("drag-over")},this.el.dropContainerTileImage.onmouseleave=this.el.dropContainerTileImage.onmouseup=function(){e.el.dropContainerTileImage.classList.remove("drag-over")},this.el.dropContainerTileImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctx.tile,i)}},this.el.dropContainerDepthMapImage.ondragover=this.el.dropContainerDepthMapImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerDepthMapImage.classList.add("drag-over")},this.el.dropContainerDepthMapImage.onmouseleave=this.el.dropContainerDepthMapImage.onmouseup=function(){e.el.dropContainerDepthMapImage.classList.remove("drag-over")},this.el.dropContainerDepthMapImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctx.depthMap,i)}},this.el.buttonDimensionsAuto.onclick=function(){var t=parseInt(e.el.inputStrips.value),i=(t+1)*e.canvas.tile.width,a=e.canvas.depthMap.height/e.canvas.depthMap.width,n=Math.round(t*e.canvas.tile.width*a);e.el.inputWidth.value=i,e.el.inputHeight.value=n},this.el.buttonScaleDimensions.onclick=function(){var t=parseInt(e.el.inputWidth.value),i=parseInt(e.el.inputHeight.value),a=parseFloat(e.el.inputScaleDimensions.value);e.el.inputWidth.value=t*a,e.el.inputHeight.value=i*a},this.el.inputStrips.onchange=function(){e.updateDepthMapOverlay()},this.updateDepthMapOverlay(),this.generateImage()}var e,i,s;return e=t,(i=[{key:"generateImage",value:function(){this.canvas.output.width=parseInt(this.el.inputWidth.value),this.canvas.output.height=parseInt(this.el.inputHeight.value),this.state={},this.state.strips=parseInt(this.el.inputStrips.value),this.state.tileWidth=this.canvas.tile.width,this.state.tileHeight=this.canvas.tile.height,this.state.tileRatio=this.state.tileHeight/this.state.tileWidth,this.state.depthStripWidth=this.canvas.depthMap.width/this.state.strips,this.state.outputStripWidth=this.canvas.output.width/(this.state.strips+1),this.state.depthScale=parseFloat(this.el.inputDepthScale.value),this.state.invert=!!this.el.checkboxInvert.checked,this.state.preserveTileRatio=!!this.el.checkboxPreserveTileRatio.checked,this.state.depthModel=this.el.selectDepthModel.value,this.state.interpolation=this.el.selectInterpolation.value,this.data={},this.data.tile=this.ctx.tile.getImageData(0,0,this.canvas.tile.width,this.canvas.tile.height),this.data.depthMap=this.ctx.depthMap.getImageData(0,0,this.canvas.depthMap.width,this.canvas.depthMap.height),this.data.output=this.ctx.output.createImageData(this.canvas.output.width,this.canvas.output.height);for(var t=0;t<this.canvas.output.width;t++)for(var e=0;e<this.canvas.output.height;e++)this.compute(t,e);this.ctx.output.putImageData(this.data.output,0,0)}},{key:"compute",value:function(t,e){var i=null;if(t<this.state.outputStripWidth){var a=t%this.state.outputStripWidth/this.state.outputStripWidth*this.state.tileWidth,n=e%this.state.tileHeight;if(this.state.preserveTileRatio){var s=this.state.outputStripWidth*this.state.tileRatio;n=e%s/s*this.state.tileHeight}i=this.getPixel(this.data.tile,a,n)}else{var r=(t-this.state.outputStripWidth)/(this.canvas.output.width-this.state.outputStripWidth),o=e/this.canvas.output.height,h=r*this.canvas.depthMap.width,u=o*this.canvas.depthMap.height,l=this.getDepth(this.getPixel(this.data.depthMap,h,u));this.state.invert&&(l=1-l);var c=l*this.state.depthScale;i=this.getPixel(this.data.output,t-this.state.outputStripWidth+c,e)}if(i){var p=4*(e*this.data.output.width+t);this.data.output.data[p+0]=i[0],this.data.output.data[p+1]=i[1],this.data.output.data[p+2]=i[2],this.data.output.data[p+3]=i[3]}}},{key:"getDepth",value:function(t){var e=(t[0]+t[1]+t[2])/765;switch(this.state.depthModel){case"linear":return e;case"quadratic":return r.quadratic(e);case"cubic":return r.cubic(e);default:return e}}},{key:"getPixel",value:function(t,e,i){e=n(e,0,t.width),i=n(i,0,t.height);var s=Math.floor(e%t.width),o=Math.floor(i%t.height);if("none"==this.state.interpolation||e-s==0&&i-o==0){var h=4*(o*t.width+s);return[t.data[h+0],t.data[h+1],t.data[h+2],t.data[h+3]]}var u=e-s,l=i-o;switch(this.state.interpolation){case"nearest-neighbour":var c=u<.5?0:1,p=l<.5?0:1;return this.getPixel(t,s+c,o+p);case"bilinear":var d=this.getPixel(t,s,o),v=this.getPixel(t,s+1,o),g=this.getPixel(t,s,o+1);return this.getPixel(t,s+1,o+1),[a(a(d[0],v[0],u),a(g[0],g[0],u),l),a(a(d[1],v[1],u),a(g[1],g[1],u),l),a(a(d[2],v[2],u),a(g[2],g[2],u),l),a(a(d[3],v[3],u),a(g[3],g[3],u),l)];case"bicubic":u=r.cubic(u),l=r.cubic(l);var f=this.getPixel(t,s,o),m=this.getPixel(t,s+1,o),y=this.getPixel(t,s,o+1);return this.getPixel(t,s+1,o+1),[a(a(f[0],m[0],u),a(y[0],y[0],u),l),a(a(f[1],m[1],u),a(y[1],y[1],u),l),a(a(f[2],m[2],u),a(y[2],y[2],u),l),a(a(f[3],m[3],u),a(y[3],y[3],u),l)];default:return this.getPixel(t,s,o)}}},{key:"setCanvasImageFromFile",value:function(t,e){var i=this,a=new FileReader;a.onload=function(e){var a=new Image;a.onload=function(){t.canvas.width=a.naturalWidth,t.canvas.height=a.naturalHeight,t.drawImage(a,0,0),i.updateDepthMapOverlay()},a.src=e.target.result},a.readAsDataURL(e)}},{key:"updateDepthMapOverlay",value:function(){var t=this.canvas.depthMap.getBoundingClientRect();this.el.depthMapOverlay.style.width="".concat(t.width,"px"),this.el.depthMapOverlay.style.height="".concat(t.height,"px");var e=t.width/parseInt(this.el.inputStrips.value);this.el.depthMapOverlay.style.backgroundSize="".concat(e,"px 100%")}},{key:"downloadImage",value:function(){var t=new Date,e=t.getFullYear(),i=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),n=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0"),o="stereogram_".concat(e,"-").concat(i,"-").concat(a,"_").concat(n,":").concat(s,":").concat(r,".png"),h=this.canvas.output.toDataURL("image/png"),u=document.createElement("a");u.href=h,u.setAttribute("download",o),u.click()}}])&&o(e.prototype,i),s&&o(e,s),t}();function u(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modules={stereogram:new h},Object.keys(this.modules).forEach((function(t){"function"==typeof e.modules[t].bind&&e.modules[t].bind(e)})),this._resize(),window.addEventListener("resize",(function(){e._resize()}))}var e,i,a;return e=t,(i=[{key:"_resize",value:function(){var t=this;Object.keys(this.modules).forEach((function(e){"function"==typeof t.modules[e].resize&&t.modules[e].resize()}))}}])&&u(e.prototype,i),a&&u(e,a),t}();window.addEventListener("load",(function(){new l}))}]);