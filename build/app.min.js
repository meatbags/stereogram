var STEREOGRAM=function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var a=function(t,e,i){return t+(e-t)*i},n=function(t,e,i){return Math.max(e,Math.min(i,t))};function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i,a;return e=t,a=[{key:"quadratic",value:function(t){return t<.5?2*t*t:(4-2*t)*t-1}},{key:"cubic",value:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}}],(i=null)&&s(e.prototype,i),a&&s(e,a),t}();function u(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var h=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cvsTile=document.querySelector("#canvas-tile"),this.cvsTile.width=100,this.cvsTile.height=100,this.ctxTile=this.cvsTile.getContext("2d"),this.ctxTile.fillStyle="#fff",this.ctxTile.fillRect(0,0,this.cvsTile.width,this.cvsTile.height),this.ctxTile.fillStyle="#000";for(var i=0;i<this.cvsTile.width;i++)for(var a=0;a<this.cvsTile.height;a++)Math.random()>.5&&this.ctxTile.fillRect(i,a,1,1);this.cvsDepthMap=document.querySelector("#canvas-depth-map"),this.cvsDepthMap.width=200,this.cvsDepthMap.height=200,this.ctxDepthMap=this.cvsDepthMap.getContext("2d"),this.ctxDepthMap.fillStyle="#000",this.ctxDepthMap.fillRect(0,0,this.cvsDepthMap.width,this.cvsDepthMap.height),this.ctxDepthMap.fillStyle="#fff",this.ctxDepthMap.beginPath(),this.ctxDepthMap.arc(100,100,50,0,2*Math.PI),this.ctxDepthMap.fill(),this.cvsOutput=document.querySelector("#canvas-output"),this.cvsOutput.width=400,this.cvsOutput.height=400,this.ctxOutput=this.cvsOutput.getContext("2d"),this.el={},this.el.buttonGenerateImage=document.querySelector("#button-generate-image"),this.el.buttonGenerateImageMessage=document.querySelector("#button-generate-image-message"),this.el.fileInputTileImage=document.querySelector("#input-tile"),this.el.fileInputDepthMapImage=document.querySelector("#input-depth-map"),this.el.dropContainerTileImage=document.querySelector("#drop-input-tile"),this.el.dropContainerDepthMapImage=document.querySelector("#drop-input-depth-map"),this.el.buttonDimensionsAuto=document.querySelector("#button-dimensions-auto"),this.el.inputWidth=document.querySelector("#input-width"),this.el.inputHeight=document.querySelector("#input-height"),this.el.inputStrips=document.querySelector("#input-strips"),this.el.inputScaleDimensions=document.querySelector("#input-scale-dimensions"),this.el.buttonScaleDimensions=document.querySelector("#button-scale-apply"),this.el.selectInterpolation=document.querySelector("#input-interpolation"),this.el.selectDepthModel=document.querySelector("#input-depth-model"),this.el.depthMapOverlay=document.querySelector("#depth-map-overlay"),this.el.buttonGenerateImage.onclick=function(){e.el.buttonGenerateImageMessage.innerText="Working...",setTimeout((function(){e.generateImage()}),50)},this.el.fileInputTileImage.onchange=function(){var t=e.el.fileInputTileImage.files[0];e.setCanvasImageFromFile(e.ctxTile,t)},this.el.fileInputDepthMapImage.onchange=function(){var t=e.el.fileInputDepthMapImage.files[0];e.setCanvasImageFromFile(e.ctxDepthMap,t)},this.el.dropContainerTileImage.ondragover=this.el.dropContainerTileImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerTileImage.classList.add("drag-over")},this.el.dropContainerTileImage.onmouseleave=this.el.dropContainerTileImage.onmouseup=function(){e.el.dropContainerTileImage.classList.remove("drag-over")},this.el.dropContainerTileImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctxTile,i)}},this.el.dropContainerDepthMapImage.ondragover=this.el.dropContainerDepthMapImage.ondragenter=function(t){t.preventDefault(),e.el.dropContainerDepthMapImage.classList.add("drag-over")},this.el.dropContainerDepthMapImage.onmouseleave=this.el.dropContainerDepthMapImage.onmouseup=function(){e.el.dropContainerDepthMapImage.classList.remove("drag-over")},this.el.dropContainerDepthMapImage.ondrop=function(t){if(t.preventDefault(),t.dataTransfer.items){var i=t.dataTransfer.items[0].getAsFile();e.setCanvasImageFromFile(e.ctxDepthMap,i)}},this.el.buttonDimensionsAuto.onclick=function(){var t=parseInt(e.el.inputStrips.value),i=(t+1)*e.cvsTile.width,a=e.cvsDepthMap.height/e.cvsDepthMap.width,n=Math.round(t*e.cvsTile.width*a);e.el.inputWidth.value=i,e.el.inputHeight.value=n},this.el.buttonScaleDimensions.onclick=function(){var t=parseInt(e.el.inputWidth.value),i=parseInt(e.el.inputHeight.value),a=parseFloat(e.el.inputScaleDimensions.value);e.el.inputWidth.value=t*a,e.el.inputHeight.value=i*a},this.el.inputStrips.onchange=function(){e.updateDepthMapOverlay()},this.updateDepthMapOverlay(),this.generateImage()}var e,i,s;return e=t,(i=[{key:"generateImage",value:function(){this.cvsOutput.width=parseInt(this.el.inputWidth.value),this.cvsOutput.height=parseInt(this.el.inputHeight.value),this.state={},this.state.strips=parseInt(this.el.inputStrips.value),this.state.tileWidth=this.cvsTile.width,this.state.tileHeight=this.cvsTile.height,this.state.depthStripWidth=this.cvsDepthMap.width/this.state.strips,this.state.outputStripWidth=this.cvsOutput.width/(this.state.strips+1),this.state.depthScale=parseFloat(document.querySelector("#input-depth-scale").value),this.state.invert=!!document.querySelector("#input-invert").checked,this.state.depthModel=this.el.selectDepthModel.value,this.state.interpolation=this.el.selectInterpolation.value,this.data={},this.data.tile=this.ctxTile.getImageData(0,0,this.cvsTile.width,this.cvsTile.height),this.data.depthMap=this.ctxDepthMap.getImageData(0,0,this.cvsDepthMap.width,this.cvsDepthMap.height),this.data.output=this.ctxOutput.createImageData(this.cvsOutput.width,this.cvsOutput.height);for(var t=0;t<this.cvsOutput.width;t++)for(var e=0;e<this.cvsOutput.height;e++)this.compute(t,e);this.ctxOutput.putImageData(this.data.output,0,0),this.el.buttonGenerateImageMessage.innerText=""}},{key:"compute",value:function(t,e){var i=null;if(t<this.state.outputStripWidth){var a=t%this.state.outputStripWidth/this.state.outputStripWidth*this.state.tileWidth,n=e%this.state.tileHeight;i=this.getPixel(this.data.tile,a,n)}else{var s=(t-this.state.outputStripWidth)/(this.cvsOutput.width-this.state.outputStripWidth),r=e/this.cvsOutput.height,u=s*this.cvsDepthMap.width,h=r*this.cvsDepthMap.height,o=this.getDepth(this.getPixel(this.data.depthMap,u,h));this.state.invert&&(o=1-o);var l=o*this.state.depthScale;i=this.getPixel(this.data.output,t-this.state.outputStripWidth+l,e)}if(i){var p=4*(e*this.data.output.width+t);this.data.output.data[p+0]=i[0],this.data.output.data[p+1]=i[1],this.data.output.data[p+2]=i[2],this.data.output.data[p+3]=i[3]}}},{key:"getDepth",value:function(t){var e=(t[0]+t[1]+t[2])/765;switch(this.state.depthModel){case"linear":return e;case"quadratic":return r.quadratic(e);case"cubic":return r.cubic(e);default:return e}}},{key:"getPixel",value:function(t,e,i){e=n(e,0,t.width),i=n(i,0,t.height);var s=Math.floor(e%t.width),u=Math.floor(i%t.height);if("none"==this.state.interpolation||e-s==0){var h=4*(u*t.width+s);return[t.data[h+0],t.data[h+1],t.data[h+2],t.data[h+3]]}var o=this.getPixel(t,s,u),l=this.getPixel(t,s+1,u),p=e-s;switch(this.state.interpolation){case"nearest-neighbour":return p<.5?o:l;case"bilinear":return[a(o[0],l[0],p),a(o[1],l[1],p),a(o[2],l[2],p),a(o[3],l[3],p)];case"bicubic":return p=r.cubic(p),[a(o[0],l[0],p),a(o[1],l[1],p),a(o[2],l[2],p),a(o[3],l[3],p)];default:return o}}},{key:"setCanvasImageFromFile",value:function(t,e){var i=this,a=new FileReader;a.onload=function(e){var a=new Image;a.onload=function(){t.canvas.width=a.naturalWidth,t.canvas.height=a.naturalHeight,t.drawImage(a,0,0),i.updateDepthMapOverlay()},a.src=e.target.result},a.readAsDataURL(e)}},{key:"updateDepthMapOverlay",value:function(){var t=this.cvsDepthMap.getBoundingClientRect();this.el.depthMapOverlay.style.width="".concat(t.width,"px"),this.el.depthMapOverlay.style.height="".concat(t.height,"px");var e=t.width/parseInt(this.el.inputStrips.value);this.el.depthMapOverlay.style.backgroundSize="".concat(e,"px 100%")}}])&&u(e.prototype,i),s&&u(e,s),t}();function o(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modules={stereogram:new h},Object.keys(this.modules).forEach((function(t){"function"==typeof e.modules[t].bind&&e.modules[t].bind(e)})),this._resize(),window.addEventListener("resize",(function(){e._resize()}))}var e,i,a;return e=t,(i=[{key:"_resize",value:function(){var t=this;Object.keys(this.modules).forEach((function(e){"function"==typeof t.modules[e].resize&&t.modules[e].resize()}))}}])&&o(e.prototype,i),a&&o(e,a),t}();window.addEventListener("load",(function(){new l}))}]);